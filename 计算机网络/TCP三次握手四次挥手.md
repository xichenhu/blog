# TCP三次握手四次挥手
## 三次握手
1. 客户端想要建立连接，发起一个syn=1 seq=x的tcp包，表示想要建立连接
2. 服务端收到包，表示可以建立连接，回复一个 ack=1 syn=1 seq=y ACKnum=x+1的包同意连接
3. 客户端收到确认包之后，了解到可以建立连接；再次发送包 ack=1 syn=0 ACKnum=y+1确认建立连接；客户端进入连接状态，服务器收到包之后也进入连接状态 tcp连接建立

## 数据传输
* 传输过程中，tcp连接会一次性发送若干个包测试连接速度，根据连接速度调整tcp包的发送频率

## 四次挥手
1. 客户端需要断开连接，发起一个fin=1 seq=x的包，请求断开连接
2. 服务端收到请求断开的包，发送一个ack=1 ACKnum=x+1的包表示请求已确认，但是这期间可能有剩余数据需要发送，将剩余的数据发送完毕
3. 服务端检查所有数据都已发送完毕，发送一个find=1 seq=y的包表示同意断开请求
4. 客户端收到同意断开请求的包，发送ack=1 ACKnum=y+1的表示确认断开连接
5. 最后阶段，服务端收到最后一个包之后，断开连接，客户端在发送最后一个包之后，等待两个最大生命周期，然后也断开连接 tpc连接断开


### 序号（sequence number）：Seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。
### 确认号（acknowledgement number）：Ack序号，占32位，只有ACK标志位为1时，确认序号字段才有效，Ack=Seq+1
### 标志位的含义
1. URG：紧急指针（urgent pointer）有效。
2. ACK：确认序号有效。
3. PSH：接收方应该尽快将这个报文交给应用层。
4. RST：重置连接。
5. SYN：发起一个新连接。
6. FIN：释放一个连接。


[link: 参考资料](https://baijiahao.baidu.com/s?id=1654225744653405133&wfr=spider&for=pc)


好的！我用一个通俗的例子来解释 TCP 的**三次握手**和**四次挥手**，帮助你轻松理解。

---

### **三次握手（建立连接）**
想象你在和朋友打电话：

1. **你：“喂，听得到吗？”**  
   （你主动发起连接，问对方是否能听到你。）

2. **朋友：“听得到！你能听到我吗？”**  
   （朋友回应你，同时也问你能否听到他。）

3. **你：“能听到！”**  
   （你确认能听到朋友，双方都确认可以正常通话了。）

这就是**三次握手**：
- 你发起请求（SYN）。
- 朋友回应并确认（SYN-ACK）。
- 你最终确认（ACK）。

---

### **四次挥手（断开连接）**
现在通话结束，你们准备挂电话：

1. **你：“我说完了，挂了啊！”**  
   （你告诉朋友你这边说完了，准备挂电话。）

2. **朋友：“好的，我知道了！”**  
   （朋友先回应你，表示他知道了。）

3. **朋友：“我也说完了，挂了啊！”**  
   （朋友也告诉你说完了，准备挂电话。）

4. **你：“好的，挂了吧！”**  
   （你最后确认，双方都挂断电话。）

这就是**四次挥手**：
- 你告诉朋友你要挂了（FIN）。
- 朋友先回应你（ACK）。
- 朋友也告诉你要挂了（FIN）。
- 你最后确认（ACK）。

---

### **总结**
- **三次握手**：双方确认可以开始通话。
- **四次挥手**：双方确认可以结束通话。




TCP（传输控制协议）是一种面向连接的协议，确保数据传输的可靠性。它通过“三次握手”建立连接，通过“四次挥手”终止连接。以下是详细过程：

### 三次握手（建立连接）

1. **SYN（同步）**：
   - 客户端向服务器发送SYN报文（SYN=1），并随机生成一个序列号（seq=x），进入SYN_SENT状态。

2. **SYN-ACK（同步-确认）**：
   - 服务器收到SYN后，发送SYN-ACK报文（SYN=1, ACK=1），确认号为x+1（ack=x+1），并随机生成自己的序列号（seq=y），进入SYN_RCVD状态。

3. **ACK（确认）**：
   - 客户端收到SYN-ACK后，发送ACK报文（ACK=1），确认号为y+1（ack=y+1），序列号为x+1（seq=x+1），进入ESTABLISHED状态。服务器收到ACK后也进入ESTABLISHED状态，连接建立。

### 四次挥手（终止连接）

1. **FIN（结束）**：
   - 客户端发送FIN报文（FIN=1），序列号为u（seq=u），进入FIN_WAIT_1状态，请求关闭连接。

2. **ACK（确认）**：
   - 服务器收到FIN后，发送ACK报文（ACK=1），确认号为u+1（ack=u+1），序列号为v（seq=v），进入CLOSE_WAIT状态。客户端收到ACK后进入FIN_WAIT_2状态。

3. **FIN（结束）**：
   - 服务器完成数据发送后，发送FIN报文（FIN=1），序列号为w（seq=w），确认号仍为u+1（ack=u+1），进入LAST_ACK状态，请求关闭连接。

4. **ACK（确认）**：
   - 客户端收到FIN后，发送ACK报文（ACK=1），确认号为w+1（ack=w+1），序列号为u+1（seq=u+1），进入TIME_WAIT状态，等待2MSL后关闭。服务器收到ACK后关闭连接。

### 总结

- **三次握手**：SYN → SYN-ACK → ACK，确保双方准备好通信。
- **四次挥手**：FIN → ACK → FIN → ACK，确保双方数据发送完毕并安全关闭连接。

这些步骤保证了TCP连接的可靠建立和终止。